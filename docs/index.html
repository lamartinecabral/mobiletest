<html>
	<head>
		<meta name="viewport" content="width=device-width, initial-scale=1.0" charset="UTF-8">
		<!-- <script>if('serviceWorker' in navigator){ navigator.serviceWorker.register('./sw.js', {scope: '/'}); };</script> -->
		<link rel="icon" type="image/ico" href="./assets/favicon.ico"/>
		<link rel="manifest" href="./manifest.webmanifest">
		<link rel="stylesheet" type="text/css" href="./style.css">
	</head>
	<body>
		<div class="center">
			
			<label for="eval">eval</label><br>
			<textarea name="eval" id="eval" cols="42" rows="20" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"></textarea><br>
			<button onclick="run()">run</button>
			<div style="display: inline; display: inline-flex; align-items: center;">
				<input type="checkbox" id="time" name="time">
				<label for="time">time</label>
			</div>
			<br>
			<label for="output">output</label><br>
			<textarea name="output" id="output" cols="42" rows="15" readonly></textarea><br>
			<button onclick="clearoutput()">clear</button><br>
			
			<h2>Just a little thing to experiment some codes while on mobile</h2>
			<p>packages included:</p>
			<ul>
				<li><a href="https://eruda.liriliri.io/">Eruda</a></li>
				<li><a href="https://github.com/ReactiveX/rxjs">RxJS</a></li>
				<li><a href="https://momentjs.com/">Moment.js</a></li>
			</ul>
			
		</div>
	</body>
	<!-- <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/eruda"></script> -->
	<!-- <script type="text/javascript" src="https://unpkg.com/rxjs/bundles/rxjs.umd.min.js"></script> -->
	<!-- <script type="text/javascript" src="https://momentjs.com/downloads/moment-with-locales.min.js"></script> -->
	<!-- <script type="text/javascript" src="./main.js"></script> -->
	<script>
alert("script started");
function run(){
	var e = document.getElementById("eval").value;
	e = e.replace(/\n/g," ");
	e = e.replace(/console\.log/g,"consolelog");
	e = e.replace(/console\.clear/g,"clearoutput");
	try {
		var before = new Date();
		var res = eval(e);
		if(res) consolelog(res);
		var after = new Date();
		if(document.getElementById("time").checked)
			consolelog(after-before+"ms");
	} catch(e){ console.error(e); }
}

function consolelog(...args){
	var o = document.getElementById("output");
	for(var arg of args){
		console.log(arg);
		if(typeof(arg) == "object") o.value += JSON.stringify(arg)+"\n";
		else o.value += arg+"\n";
	}
}

function cleareval(){
	document.getElementById("eval").value = "";
}

function clearoutput(){
	document.getElementById("output").value = "";
}

function identation(ev){
	if(ev.keyCode === 13){
		var {value, selectionStart} = ev.target;
		value = [value.slice(0,selectionStart), value.slice(selectionStart)];
		var lines = value[0].split("\n");
		if(lines.length < 2) return;
		for(var c of lines[lines.length-2]){
			if(c != " " && c != "\t") break;
			lines[lines.length-1] = c + lines[lines.length-1];
			selectionStart++;
		}
		value[0] = lines.join("\n");
		ev.target.value = value.join("");
		ev.target.selectionStart = selectionStart;
		ev.target.selectionEnd = selectionStart;
	}
}

function tabinput(ev){
	if(ev.keyCode === 9){
		ev.preventDefault();
		var {value, selectionStart} = ev.target;
		value = [value.slice(0,selectionStart), value.slice(selectionStart)];
		value[0] += "  ";
		selectionStart += 2;
		ev.target.value = value.join("");
		ev.target.selectionStart = selectionStart;
		ev.target.selectionEnd = selectionStart;
	}
}

document.getElementById("eval").onkeyup = identation;
document.getElementById("eval").onkeydown = tabinput;	
	</script>
</html>
